{% extends 'designs/base.html' %}
{% block title %}عرض التصاميم - StyleBox{% endblock %}

{% block content %}
<h1 class="page-title">🎨 كل التصاميم</h1>

<div class="filter-container">
    <a href="?" class="filter-btn active">✨ الكل</a>
    <a href="?type=button" class="filter-btn">🔘 أزرار</a>
    <a href="?type=card" class="filter-btn">🃏 كروت</a>
    <a href="?type=navbar" class="filter-btn">🧭 شريط التنقل</a>
    <a href="?type=header" class="filter-btn">📑 رأس الصفحة</a>
    <a href="?type=form" class="filter-btn">📝 نموذج</a>

    <!----New filter for loaders  !!!!!!!   ضيفه فالباك!   !!!!!!!!!!!--->
    <a href="?type=loader" class="filter-btn">⌛ تحميل</a>
</div>

<!-- Design Grid -->
<div class="design-grid">
    {% for design in designs %}
        <div class="design-card">
            <div class="card-content">
                <h2 class="design-title">{{ design.name }}</h2>
                
                <div class="design-type">
                    <span>🏷️</span>
                    <span>{{ design.get_design_type_display }}</span>
                </div>
                
                <p class="design-description">{{ design.description|default:"بدون وصف متاح لهذا التصميم" }}</p>
                
                <!-- Live Preview -->
                <div class="preview-box">
                    <iframe
                        id="preview-iframe-{{ design.id }}"
                        class="preview-iframe"
                        onload="
                            const iframe = this;
                            const doc = iframe.contentWindow.document;
                            doc.open();
                            doc.write(`<!DOCTYPE html>
                            <html>
                            <head>
                                <style>
                                    body { margin: 0; padding: 1rem; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
                                    {{ design.css_code|escapejs }}
                                </style>
                            </head>
                            <body>
                                {{ design.html_code|escapejs }}
                            </body>
                            </html>`);
                            doc.close();
                        ">
                    </iframe>
                </div>
        <!-- أزرار النسخ -->
        <div class="copy-buttons">
          <button class="btn-copy" onclick="copyToClipboard(`{{ design.html_code|escapejs }}`)">📋 نسخ HTML</button>
          <button class="btn-copy" onclick="copyToClipboard(`{{ design.css_code|escapejs }}`)">📋 نسخ CSS</button>
        </div>
      </div>
{% if request.user == design.creator %}
  <a href="{% url 'edit_design' design.pk %}" class="btn-primary mt-2 inline-block">✏️ تعديل التصميم</a>
{% endif %}

      <!-- بيانات المصمم -->
      <div class="text-sm text-gray-600 mt-auto">
        👤 بواسطة:
        <a href="{% url 'designer_profile' design.creator.username %}" class="text-blue-500 hover:underline">
          {{ design.creator.username }}
        </a><br>
        🕒 بتاريخ: {{ design.created_at|date:"Y-m-d H:i" }}
      </div>
    </div>
  {% empty %}
    <p class="text-center text-gray-500 col-span-3">لا توجد تصاميم بعد.</p>
  {% endfor %}
  
</div>
{% endblock %}
