{% extends 'designs/base.html' %}
{% block title %}إضافة تصميم جديد - StyleBox{% endblock %}
{% block content %}
<div class="form-box">
  <h2 class="page-title">➕ إضافة تصميم جديد</h2>
  <form method="POST" id="design-form">
    {% csrf_token %}
    <div class="form-group">
      <label for="id_name" class="form-label">اسم التصميم:</label>
      {{ form.name }}
    </div>
    <div class="form-group">
      <label for="id_design_type" class="form-label">نوع التصميم:</label>
      {{ form.design_type }}
    </div>
    <div class="form-group">
      <label for="id_description" class="form-label">وصف التصميم:</label>
      {{ form.description }}
    </div>
    <div class="form-group">
      <label for="id_html_code" class="form-label">كود HTML:</label>
      {{ form.html_code }}
    </div>
    <div class="form-group">
      <label for="id_css_code" class="form-label">كود CSS:</label>
      {{ form.css_code }}
    </div>
    <div class="button-group" style="display: flex; gap: 10px; margin-top: 20px;">
  <button type="submit" name="action" value="save_home" class="btn btn-primary">
    💾 حفظ والعودة للصفحة الرئيسية
  </button>
  <button type="submit" name="action" value="save_new" class="btn btn-secondary">
    ➕ حفظ وإنشاء جديد
  </button>
</div>

  </form>

  <hr>
  <h3>👁️‍🗨️ معاينة فورية:</h3>
  <iframe id="live-preview" style="width:100%; height:400px; border:1px solid #ccc;"></iframe>
</div>

<script>
  const htmlField = document.getElementById('id_html_code');
  const cssField = document.getElementById('id_css_code');
  const previewFrame = document.getElementById('live-preview');

  function updatePreview() {
    const html = htmlField.value;
    const css = `<style>${cssField.value}</style>`;
    const output = `${css}${html}`;
    const preview = previewFrame.contentDocument || previewFrame.contentWindow.document;
    preview.open();
    preview.write(output);
    preview.close();
  }

  htmlField.addEventListener('input', updatePreview);
  cssField.addEventListener('input', updatePreview);

  // تحديث المعاينة عند التحميل الأولي (لو فيه كود جاهز)
  document.addEventListener("DOMContentLoaded", updatePreview);
</script>
{% endblock %}